# Production Environment Configuration for lixSearch
# Copy this file to .env and customize values before deployment

# ============================================================================
# DEPLOYMENT MODE
# ============================================================================
# single-vps: Single VPS deployment (uses Redis Sentinel for HA)
# multi-vps: Multiple VPS deployment (uses Redis Cluster + gossip protocol)
DEPLOYMENT_MODE=single-vps

# ============================================================================
# REDIS CONFIGURATION (Semantic Cache)
# ============================================================================
SEMANTIC_CACHE_REDIS_HOST=redis
SEMANTIC_CACHE_REDIS_PORT=6379
SEMANTIC_CACHE_REDIS_DB=0
SEMANTIC_CACHE_REDIS_TTL=300
SEMANTIC_CACHE_REDIS_SIMILARITY_THRESHOLD=0.90
SEMANTIC_CACHE_REDIS_MAX_ITEMS_PER_URL=50

# ============================================================================
# URL EMBEDDING CACHE (Global, 24h TTL)
# ============================================================================
URL_EMBEDDING_CACHE_TTL=86400
URL_EMBEDDING_CACHE_BATCH_SIZE=50

# ============================================================================
# SESSION CONTEXT WINDOW (Per-Session, LRU-managed)
# ============================================================================
SESSION_CONTEXT_WINDOW_SIZE=20
SESSION_CONTEXT_WINDOW_TTL=1800
SESSION_CONTEXT_WINDOW_MAX_TOKENS=2000

# ============================================================================
# CHROMA VECTOR DATABASE
# ============================================================================
CHROMA_SERVER_HOST=chroma-server
CHROMA_SERVER_PORT=8000
CHROMA_TIMEOUT=120

# ============================================================================
# EMBEDDING SERVICE
# ============================================================================
EMBEDDING_MODEL=sentence-transformers/all-minilm-l6-v2
EMBEDDING_DIMENSION=384
EMBEDDING_BATCH_SIZE=32
EMBEDDING_TIMEOUT=60

# ============================================================================
# RETRIEVAL PARAMETERS
# ============================================================================
RETRIEVAL_TOP_K=5
RETRIEVAL_SCORE_THRESHOLD=0.7
RETRIEVAL_TIMEOUT=30

# ============================================================================
# APPLICATION WORKERS
# ============================================================================
# Number of worker processes per container (Hypercorn)
WORKER_COUNT=10
# Not exposed; accessed via Nginx load balancer
WORKER_BIND_HOST=0.0.0.0
WORKER_BIND_PORT=8000

# ============================================================================
# LOGGING
# ============================================================================
LOG_LEVEL=INFO
LOG_FORMAT=json

# ============================================================================
# RAG SERVICE
# ============================================================================
RAG_ENABLE_CACHE=true
RAG_ENABLE_CONTEXT_WINDOW=true
RAG_ENABLE_SESSION_ISOLATION=true

# ============================================================================
# SCALING PARAMETERS
# ============================================================================
# Redis connection pool size (shared across containers)
REDIS_POOL_SIZE=50
# Max concurrent sessions
MAX_CONCURRENT_SESSIONS=1000
# Session timeout (seconds)
SESSION_TIMEOUT=3600

# ============================================================================
# SECURITY
# ============================================================================
# Enable HTTPS (requires SSL certificates in ./ssl/)
ENABLE_HTTPS=false
# CORS allowed origins (comma-separated)
CORS_ORIGINS=http://localhost:3000,https://example.com
# Rate limiting (requests per second per IP)
RATE_LIMIT_GENERAL=100
RATE_LIMIT_SEARCH=50
RATE_LIMIT_CHAT=30

# ============================================================================
# MONITORING & OBSERVABILITY
# ============================================================================
ENABLE_METRICS=true
METRICS_PORT=9090
ENABLE_TRACING=false
TRACING_SERVICE_NAME=lixsearch

# ============================================================================
# EXTERNAL SERVICES (Optional)
# ============================================================================
# API keys and endpoints for function calls
YOUTUBE_API_KEY=
TIMEZONE_API_KEY=
IMAGE_GENERATION_API_KEY=

# ============================================================================
# DATABASE & PERSISTENCE
# ============================================================================
# Redis persistence
REDIS_AOF_ENABLED=yes
REDIS_AOF_FSYNC=everysec
# Chroma persistence
CHROMA_PERSIST_DIRECTORY=/data/embeddings
